{"version":3,"sources":["../src/template-manager.js"],"names":[],"mappings":"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","file":"template-manager.js","sourcesContent":["/**\n * Small utility module for compling HTML templates or pre-processed CSS.\n *\n * @author: [@jasonsims]('https://github.com/jasonsims')\n */\n\nimport {extname, dirname, basename} from 'path'\nimport cons from 'consolidate'\nimport P from 'bluebird'\n\nvar engineMap = {\n  // HTML Template engines\n  'hbs': cons.handlebars.render,\n  'emblem': renderEmblem,\n  // CSS pre-processors\n  'less': renderLess,\n  'stylus': renderStylus,\n  'styl': renderStyl,\n  'sass': renderSass,\n  'scss': renderSass,\n  // Handle plain CSS also\n  'css': renderDefault,\n  '': renderDefault\n}\n\nexport function render (file, locals = {}, callback) {\n  let {filename, content} = file\n\n  return new P(function (resolve, reject) {\n    if (!content) return reject('No content in template')\n    if (!filename) return reject('Filename is null')\n    let engine = extname(filename).slice(1)\n\n    locals.filename = filename\n    locals.engine = '.' + engine\n    locals.templatePath = dirname(filename)\n\n    if (engine.length && cons[engine] !== undefined) {\n      // use consolidate.js if it supports this engine\n      return cons[engine].render(content, locals, function (err, rendered) {\n        if (err) return reject(err)\n        resolve(rendered)\n      })\n    } else {\n      // or use the function defined in the engineMap\n      var fn = engineMap[engine]\n      return resolve(fn(content, locals))\n    }\n    return reject(`Can't render file with extension ${engine}`)\n  })\n  .nodeify(callback)\n}\n\n// Deprecated. This engine is deprecated since v2.0\nfunction renderEmblem (source, locals) {\n  const emblem = require('emblem')\n  const handlebars = require('handlebars')\n  console.warn('Please migrate your templates to other engine. Email Templates will stop supporting emblem on the next version')\n\n  var template = emblem.compile(handlebars, source)\n  return P.resolve(template(locals))\n}\n\n// CSS pre-processors\nfunction renderLess (source, locals) {\n  const less = require('less')\n  var dir = dirname(locals.filename)\n  var base = basename(locals.filename)\n\n  return new P(function (done, reject) {\n    less.render(source, {\n      paths: [dir],\n      filename: base\n    }, function (err, output) {\n      if (err) return reject(err)\n      done(output.css || output)\n    })\n  })\n}\n\nfunction renderStylus (source, locals) {\n  const stylus = require('stylus')\n\n  // Render stylus synchronously as it does not appear to handle asynchronous\n  // calls properly when an error is generated.\n  const css = stylus.render(source, locals)\n  return P.resolve(css)\n}\n\nfunction renderStyl (source, locals) {\n  const styl = require('styl')\n\n  const css = styl(source, locals).toString()\n  return P.resolve(css)\n}\n\nfunction renderSass (source, locals) {\n  const sass = require('node-sass')\n\n  locals.data = source\n  locals.includePaths = [locals.templatePath]\n\n  return new P(function (done, reject) {\n    sass.render(locals, function (err, data) {\n      if (err) return reject(err)\n      done(data.css.toString())\n    })\n  })\n}\n// Default wrapper for handling standard CSS and empty source.\nfunction renderDefault (source) {\n  return P.resolve(source)\n}\n"]}